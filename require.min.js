/*!
 * Copyright (C) 2009-2010 - Kris Kowal MIT License
 * Copyright (C) 2009 - 280 North Inc. http://280north.com/ MIT License
 * Copyright (C) 2009 - Google, Inc. Apache 2.0 License
 */
if(!Array.isArray){Array.isArray=function(a){return Object.prototype.toString.call(a)=="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(d,b){var a=this.length>>>0;for(var c=0;c<a;c++){if(c in this){d.call(b,this[c],c,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}var e=new Array(a);var d=arguments[1];for(var c=0;c<a;c++){if(c in this){e[c]=b.call(d,this[c],c,this)}}return e}}if(!Array.prototype.filter){Array.prototype.filter=function(d){var a=[];var c=arguments[1];for(var b=0;b<this.length;b++){if(d.call(c,this[b])){a.push(this[b])}}return a}}if(!Array.prototype.every){Array.prototype.every=function(c){var b=arguments[1];for(var a=0;a<this.length;a++){if(!c.call(b,this[a])){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(c){var b=arguments[1];for(var a=0;a<this.length;a++){if(c.call(b,this[a])){return true}}return false}}if(!Array.prototype.reduce){Array.prototype.reduce=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=a-1;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c--];break}if(--c<0){throw new TypeError()}}while(true)}for(;c>=0;c--){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){var b=this.length;if(!b){return -1}var a=arguments[1]||0;if(a>=b){return -1}if(a<0){a+=b}for(;a<b;a++){if(!Object.prototype.hasOwnProperty.call(this,a)){continue}if(c===this[a]){return a}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(c){var b=this.length;if(!b){return -1}var a=arguments[1]||b;if(a<0){a+=b}a=Math.min(a,b-1);for(;a>=0;a--){if(!Object.prototype.hasOwnProperty.call(this,a)){continue}if(c===this[a]){return a}}return -1}}if(!Object.getPrototypeOf){Object.getPrototypeOf=function(a){return a.__proto__}}if(!Object.getOwnPropertyDescriptor){Object.getOwnPropertyDescriptor=function(a){return{}}}if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function(a){return Object.keys(a)}}if(!Object.create){Object.create=function(c,d){if(typeof c!="object"||c===null){throw new TypeError("typeof prototype["+(typeof c)+"] != 'object'")}function a(){}a.prototype=c;var b=new a();if(typeof d!=="undefined"){Object.defineProperties(b,d)}return b}}if(!Object.defineProperty){Object.defineProperty=function(b,c,d){var a=Object.prototype.hasOwnProperty;if(typeof d=="object"&&b.__defineGetter__){if(a.call(d,"value")){if(!b.__lookupGetter__(c)&&!b.__lookupSetter__(c)){b[c]=d.value}if(a.call(d,"get")||a.call(d,"set")){throw new TypeError("Object doesn't support this action")}}else{if(typeof d.get=="function"){b.__defineGetter__(c,d.get)}}if(typeof d.set=="function"){b.__defineSetter__(c,d.set)}}return b}}if(!Object.defineProperties){Object.defineProperties=function(a,b){for(var c in b){if(Object.prototype.hasOwnProperty.call(b,c)){Object.defineProperty(a,c,b[c])}}return a}}if(!Object.seal){Object.seal=function(a){return a}}if(!Object.freeze){Object.freeze=function(a){return a}}if(!Object.preventExtensions){Object.preventExtensions=function(a){return a}}if(!Object.isSealed){Object.isSealed=function(a){return false}}if(!Object.isFrozen){Object.isFrozen=function(a){return false}}if(!Object.isExtensible){Object.isExtensible=function(a){return true}}if(!Object.keys){Object.keys=function(b){var c=[];for(var a in b){if(Object.prototype.hasOwnProperty.call(b,a)){c.push(a)}}return c}}if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){return(this.getFullYear()+"-"+(this.getMonth()+1)+"-"+this.getDate()+"T"+this.getHours()+":"+this.getMinutes()+":"+this.getSeconds()+"Z")}}if(!Date.now){Date.now=function(){return new Date().getTime()}}if(!Date.prototype.toJSON){Date.prototype.toJSON=function(a){if(typeof this.toISOString!="function"){throw new TypeError()}return this.toISOString()}}if(isNaN(Date.parse("T00:00"))){Date=(function(c){var a=function(g,n,e,l,k,o,f){var i=arguments.length;if(this instanceof c){var j=i===1&&String(g)===g?new c(a.parse(g)):i>=7?new c(g,n,e,l,k,o,f):i>=6?new c(g,n,e,l,k,o):i>=5?new c(g,n,e,l,k):i>=4?new c(g,n,e,l):i>=3?new c(g,n,e):i>=2?new c(g,n):i>=1?new c(g):new c();j.constructor=a;return j}return c.apply(this,arguments)};var d=new RegExp("^(?:((?:[+-]\\d\\d)?\\d\\d\\d\\d)(?:-(\\d\\d)(?:-(\\d\\d))?)?)?(?:T(\\d\\d):(\\d\\d)(?::(\\d\\d)(?:\\.(\\d\\d\\d))?)?)?(?:Z|([+-])(\\d\\d):(\\d\\d))?$");for(var b in c){a[b]=c[b]}a.now=c.now;a.UTC=c.UTC;a.prototype=c.prototype;a.prototype.constructor=a;a.parse=function(f){var e=d.exec(f);if(e){e.shift();var h=e[0]===undefined;for(var g=0;g<10;g++){if(g===7){continue}e[g]=+(e[g]||(g<3?1:0));if(g===1){e[g]--}}if(h){return((e[3]*60+e[4])*60+e[5])*1000+e[6]}var j=(e[8]*60+e[9])*60*1000;if(e[6]==="-"){j=-j}return c.UTC.apply(this,e.slice(0,7))+j}return c.parse.apply(this,arguments)};return a})(Date)}var slice=Array.prototype.slice;if(!Function.prototype.bind){Function.prototype.bind=function(c){var d=this;if(typeof d.apply!="function"||typeof d.call!="function"){return new TypeError()}var a=slice.call(arguments);var b=function(){if(this instanceof b){var e=Object.create(d.prototype);d.apply(e,a.concat(slice.call(arguments)));return e}else{return d.call.apply(d,a.concat(slice.call(arguments)))}};b.bound=d;b.boundTo=c;b.boundArgs=a;b.length=(typeof d=="function"?Math.max(d.length-a.length,0):0);return b}}if(!String.prototype.trim){var trimBeginRegexp=/^\s\s*/;var trimEndRegexp=/\s\s*$/;String.prototype.trim=function(){return String(this).replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}(function(h,f){var c;if(typeof setTimeout==="function"){c=function(m){setTimeout(m,0)}}else{c=require("./event-loop").enqueue}var b;if(typeof require!=="undefined"){try{b=require("system").print}catch(e){b=require("sys").puts}}else{if(typeof console!=="undefined"){b=function(m){console.log(m)}}else{b=function(){}}}h.debug=false;h.enqueue=c;h.defer=a;function a(){var p=[],n;var o=Object.create(k.prototype);o.emit=function(){var q=Array.prototype.slice.call(arguments);if(p){p.push(q)}else{i.apply(f,[n].concat(q))}};var m=function(q){var s,t,r;if(!p){return}n=d(q);for(s=0,t=p.length;s<t;++s){i.apply(f,[n].concat(p[s]))}p=f};return{promise:o,resolve:m,reject:function(q){m(l(q))}}}h.Promise=k;function k(m,o){if(o===f){o=function(p){return l("Promise does not support operation: "+p)}}var n=Object.create(k.prototype);n.emit=function(s,q){var r=Array.prototype.slice.call(arguments,2);var p;if(m[s]){p=m[s].apply(m,r)}else{p=o.apply(m,arguments)}if(q){return q(p)}return p};return n}k.prototype.toSource=function(){return this.toString()};k.prototype.toString=function(){return"[object Promise]"};k.prototype.valueOf=function(){return this.emit("valueOf")};h.isPromise=j;function j(m){return m instanceof k}h.reject=l;function l(m){return k({when:function(o){return o?o(m):l(m)}},function n(q,p){var o=l(m);return p?p(o):o})}h.ref=d;function d(m){if(j(m)){return m}return k({when:function(n){return m},get:function(n){return m[n]},put:function(n,o){m[n]=o},"delete":function(n){delete m[n]},post:function(o,n){return m[o].apply(m,n)},valueOf:function(){return m}})}h.Method=g;function g(m){return function(p){var n=a();var o=Array.prototype.slice.call(arguments,1);i.apply(f,[d(p),m,n.resolve].concat(o));return n.promise}}h.when=function(q,n,p){var o=a();var m=false;i(d(q),"when",function(r){if(m){return}m=true;o.resolve(d(r).emit("when",n,p))},function(r){if(m){return}m=true;o.resolve(p?p(r):l(r))});return o.promise};h.asap=function(o,m,n){if(h.isPromise(o)){return h.when(o,m,n)}else{return m(o)}};h.get=g("get");h.put=g("put");h.del=g("del");h.post=g("post");h.defined=function(m){return h.when(m,function(n){if(n===f||n===null){return l("Resolved undefined value: "+n)}return n})};function i(n){var m=Array.prototype.slice.call(arguments,1);c(function(){try{n.emit.apply(n,m)}catch(o){b(o)}})}})(typeof exports!=="undefined"?exports:this["/q"]={});(function(b,a,d){a.Module=function(f,h,g){var e=function(k){var l=[],i=[];for(var j in k){if(Object.prototype.hasOwnProperty.call(k,j)){l.push(j);i.push(k[j])}}return Function.apply(null,l.concat([f])).apply(this,i)};e.requirements=a.getRequirements(f);return e};var c=(/require\s*\(\s*(['"])((?:\w|\$|\.|\/)+)\1\s*\)/m);a.getRequirements=function(k){var e=[];var f=k.split(";");var h=0,j=f.length;for(;h<j;h++){var g=c.exec(f[h]);if(!g){break}e.push(g[2])}return e}}).apply({},typeof exports!=="undefined"?[require,exports]:[(function(a){return function(b){return a["/"+b]}})(this),this["/module"]={}]);(function(a,c){var b;a.Request=function(){if(b){return b()}var e=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP.6.0")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){throw new Error("No HTTP Request object available for your environment.")}];var h,d,g;for(var f=0;f<e.length;f++){g=c;b=e[f];try{d=b()}catch(j){g=j;continue}break}if(g){throw g}else{return d}}})(typeof exports!=="undefined"?exports:this["/http"]={});(function(b,a){var c=b("q");var d=b("./http");a.read=function(g){var e=c.defer();var f=d.Request();f.open("GET",g,true);f.onreadystatechange=function(){if(f.readyState===4){var h;try{h=f.status}catch(i){}if(h===200){e.resolve(f.responseText)}else{e.reject("HTTP "+h+" for "+g)}}};f.send("");return e.promise}}).apply({},typeof exports!=="undefined"?[require,exports]:[(function(a){return function(b){return a["/"+b.replace("./","")]}})(this),this["/q-http"]={}]);(function(c,a){var d=c("q");var e=c("q-http");var b=c("./module");a.Loader=function(i){i=i||{};var f={};var k=i.factories||{};var l=i.path;var h=i.Module||b.Module;var j=i.next||function(m){return d.reject({message:"require error: couldn't find \""+m+'"'})};var g=i.debug;f.resolve=function(o,m){o=String(o);var n=o.split("/");if(o.charAt(0)==="."){n.pop();n.push(o)}return n.join("/").replace(/\.\.\/[^\/]+\//g,"/")};f.fetch=function(n){var m=l+"/"+n+".js";return e.read(m)};f.Module=function(o,m,n){return d.when(n,function(q){var p=h(o,q,1);p.path=q;return p})};f.load=function(o,p,n){n=n||{};var m=Object.prototype.hasOwnProperty.call(k,o);if(!m){return d.when(f.reload(o,p),function(){return k[o]})}else{return k[o]}};f.reload=function(m,n){return d.when(f.fetch(m,n),function(o){return d.when(f.Module(o,m,n),function(p){k[m]=p})})};f.isLoaded=function(m){return Object.prototype.hasOwnProperty.call(k,m)};return f}}).apply({},typeof exports!=="undefined"?[require,exports]:[(function(a){return function(b){return a["/"+b.replace("./","")]}})(this),this["/loader"]={}]);(function(c,a){var d=c("q");var b=Object.prototype.hasOwnProperty;var f=function(i,g){for(var h in g){if(b.call(g,h)){i[h]=g[h]}}};var e=function(g){var h={};f(h,g);return h};a.Require=function(p){p=p||{};var n=p.loader;var k=p.factories||{};var j=p.modules||{};var m=p.exports||{};for(var g in m){if(b.call(m,g)){j[g]={exports:m[g]}}}var i=function(q,x,y){var r,w,u,v,s;y=y||{};q=n.resolve(q,x);if(b.call(j,q)){r=j[q]}else{if(b.call(k,q)){w=k[q];r=l(q,w.path);j[q]=r;u=j[q].exports;s=o(q);scope={require:s,exports:u,module:r};f(scope,y.scope||{});try{var t=w(scope);v=true}finally{if(!v){delete j[q]}}if(typeof t!=="undefined"){r.exports=t}}else{throw new Error("require: could not load "+q)}}return r.exports};var o=function(r){var q=function(s){return i(s,r)};q.async=function(s){return i.async(s,r)};q.loader=n;q.main=j[p.main];return q};var l=function(q,s){var r={};r.exports={};r.id=q;r.path=s;return r};var h=function(r,q){return d.when(n.load(r),function(s){q[r]=s;return s.requirements.reduce(function(t,u){u=n.resolve(u,r);return d.when(t,function(v){if(b.call(j,u)||b.call(v,u)){return v}return h(u,v)})},q)})};i.reload=function(q){return d.when(h(q,{}),function(r){return a.Require({loader:n,factories:r})})};i.ensure=function(r,t){var q=e(j);var s=r.reduce(function(u,v){return d.when(u,function(w){return h(v,w)})},e(k));return d.when(s,function(u){t(a.Require({loader:n,factories:u,modules:q}))},function(u){throw new Error(u.message||u)})};i.async=function(t,r){var s=e(k);var q=e(j);return d.when(h(t,s),function(v){var u=a.Require({loader:n,factories:v,modules:q});return u(t,r)})};i.exec=function(t,r){var s=e(k);var q=e(j);return d.when(h(t,s),function(v){var u=a.Require({loader:n,factories:v,modules:q,main:t});return u(t,undefined,{scope:r})})};i.loader=n;return i}}).apply({},typeof exports!=="undefined"?[require,exports]:[(function(a){return function(b){return a["/"+b]}})(this),this["/require"]={}]);(function(c){var a=function(f){return c["/"+f]};var b=a("q");var d=a("require");var e=a("loader");c.Require=function(g){var f=e.Loader({path:g});return d.Require({loader:f,exports:{q:b,"require/loader":e,"require/require":d,"require/module":a("module"),"require/http":a("http"),"require/q-http":a("q-http")}})}})(this);
